2017-07-15 17:22:36.220 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 9208 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:22:36.223 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:22:59.281 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 24.195 seconds (JVM running for 25.262)
2017-07-15 17:23:43.344 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:23:43.356 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:23:43.365 INFO  [http-nio-8080-exec-1] c.s.s.s.e.JWTAuthenticationEntryPoint [JWTAuthenticationEntryPoint.java : 29] - 到达JWTAuthenticationEntryPoint
2017-07-15 17:23:43.410 INFO  [http-nio-8080-exec-2] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:23:43.410 INFO  [http-nio-8080-exec-2] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:23:43.411 INFO  [http-nio-8080-exec-2] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:23:43.412 INFO  [http-nio-8080-exec-2] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:24:33.819 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 9208 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:24:33.819 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:25:20.476 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:25:20.478 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:25:44.491 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 25.217 seconds (JVM running for 26.191)
2017-07-15 17:26:49.147 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:26:49.154 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:26:49.164 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:26:49.164 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:26:49.194 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 1, 5]
2017-07-15 17:26:49.197 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 0, 5]
2017-07-15 17:26:49.303 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:26:49.304 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:26:49.344 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] begins with Parameters: [org.apache.catalina.core.ApplicationHttpRequest@69c654e9, org.apache.catalina.connector.ResponseFacade@725978ea]
2017-07-15 17:26:49.354 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] ends with Result: ModelAndView: reference to view with name 'error'; model is {timestamp=Sat Jul 15 17:26:49 CST 2017, status=500, error=Internal Server Error, exception=org.springframework.http.converter.HttpMessageNotWritableException, message=Could not write JSON: (was java.lang.NullPointerException); nested exception is com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl["facets"]), path=/articles/Hybrid}
2017-07-15 17:27:53.253 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:27:53.253 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:28:09.283 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 16.199 seconds (JVM running for 170.983)
2017-07-15 17:28:58.151 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:28:58.158 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:28:58.159 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:28:58.160 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:28:58.162 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 1, 5]
2017-07-15 17:28:58.165 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 0, 5]
2017-07-15 17:28:58.182 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:28:58.183 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:28:58.190 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] begins with Parameters: [org.apache.catalina.core.ApplicationHttpRequest@77b42958, org.apache.catalina.connector.ResponseFacade@7c817f8d]
2017-07-15 17:28:58.202 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] ends with Result: ModelAndView: reference to view with name 'error'; model is {timestamp=Sat Jul 15 17:28:58 CST 2017, status=500, error=Internal Server Error, exception=org.springframework.http.converter.HttpMessageNotWritableException, message=Could not write JSON: (was java.lang.NullPointerException); nested exception is com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl["facets"]), path=/articles/Hybrid}
2017-07-15 17:29:48.056 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:29:48.056 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:30:17.569 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 29.663 seconds (JVM running for 299.269)
2017-07-15 17:30:23.987 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:30:23.994 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:30:23.995 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:30:23.995 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:30:23.998 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 1, 5]
2017-07-15 17:30:24.001 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 0, 5]
2017-07-15 17:30:24.017 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:30:24.017 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:30:24.023 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] begins with Parameters: [org.apache.catalina.core.ApplicationHttpRequest@71d5170c, org.apache.catalina.connector.ResponseFacade@4b66d509]
2017-07-15 17:30:24.033 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] ends with Result: ModelAndView: reference to view with name 'error'; model is {timestamp=Sat Jul 15 17:30:24 CST 2017, status=500, error=Internal Server Error, exception=org.springframework.http.converter.HttpMessageNotWritableException, message=Could not write JSON: (was java.lang.NullPointerException); nested exception is com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl["facets"]), path=/articles/Hybrid}
2017-07-15 17:32:44.603 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:32:44.603 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:33:19.758 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 35.339 seconds (JVM running for 481.458)
2017-07-15 17:35:10.595 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:35:10.601 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:35:10.602 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:35:10.602 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:35:10.613 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] begins with Parameters: [org.apache.catalina.core.ApplicationHttpRequest@2af44055, org.apache.catalina.connector.ResponseFacade@7af7bda0]
2017-07-15 17:35:10.620 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] ends with Result: ModelAndView: reference to view with name 'error'; model is {timestamp=Sat Jul 15 17:35:10 CST 2017, status=404, error=Not Found, message=No message available, path=/articles/Hybrid}
2017-07-15 17:35:41.958 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:35:41.959 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:36:00.641 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 18.84 seconds (JVM running for 642.34)
2017-07-15 17:36:03.762 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:36:03.769 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:36:03.770 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:36:03.770 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:36:03.772 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 1, 5]
2017-07-15 17:36:03.777 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 0, 5]
2017-07-15 17:36:03.797 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:36:03.798 INFO  [http-nio-8080-exec-1] c.s.s.c.article.ArticleController [ArticleController.java : 29] - page:[ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)]
2017-07-15 17:36:03.798 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:36:03.805 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] begins with Parameters: [org.apache.catalina.core.ApplicationHttpRequest@2d6fb163, org.apache.catalina.connector.ResponseFacade@3b5d9dfc]
2017-07-15 17:36:03.814 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(HttpServletRequest,HttpServletResponse) ] ends with Result: ModelAndView: reference to view with name 'error'; model is {timestamp=Sat Jul 15 17:36:03 CST 2017, status=500, error=Internal Server Error, exception=org.springframework.http.converter.HttpMessageNotWritableException, message=Could not write JSON: (was java.lang.NullPointerException); nested exception is com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: org.springframework.data.elasticsearch.core.aggregation.impl.AggregatedPageImpl["facets"]), path=/articles/Hybrid}
2017-07-15 17:38:18.253 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:38:18.254 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:38:51.230 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 33.152 seconds (JVM running for 812.93)
2017-07-15 17:38:55.267 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:38:55.267 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:39:39.119 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 44.026 seconds (JVM running for 860.819)
2017-07-15 17:46:57.484 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:46:57.485 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:47:23.108 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 26.135 seconds (JVM running for 1324.808)
2017-07-15 17:47:43.673 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 48] - Starting SpringBootSkeletonApplication on LAPTOP-0E5JL9PN with PID 1164 (D:\idea\SpringBootSkeleton\skeleton\target\classes started by songx in D:\idea\SpringBootSkeleton)
2017-07-15 17:47:43.674 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [SpringApplication.java : 597] - The following profiles are active: dev
2017-07-15 17:47:59.114 INFO  [restartedMain] c.s.s.SpringBootSkeletonApplication [StartupInfoLogger.java : 57] - Started SpringBootSkeletonApplication in 15.82 seconds (JVM running for 1360.814)
2017-07-15 17:48:40.201 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:48:40.208 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:48:40.208 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 36] - 经过JWTAuthenticationTokenFilter
2017-07-15 17:48:40.209 INFO  [http-nio-8080-exec-1] c.s.s.s.f.JWTAuthenticationTokenFilter [JWTAuthenticationTokenFilter.java : 42] - Token无效
2017-07-15 17:48:40.212 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ PageInfo cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 1, 5]
2017-07-15 17:48:40.216 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 22] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] begins with Parameters: [Hybrid, 0, 5]
2017-07-15 17:48:40.249 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ Page cn.sinjinsong.skeleton.service.article.impl.ArticleServiceImpl.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: Page 1 of 1 containing cn.sinjinsong.skeleton.domain.entity.article.ArticleDO instances
2017-07-15 17:48:40.251 INFO  [http-nio-8080-exec-1] c.s.skeleton.aop.LoggingAspect [LoggingAspect.java : 27] - The method [ PageInfo cn.sinjinsong.skeleton.controller.article.ArticleController.findByBodyContainingWithHighlight(String,Integer,Integer) ] ends with Result: PageInfo{pageNum=1, pageSize=5, size=1, startRow=0, endRow=0, total=1, pages=1, list=[ArticleDO(id=2, author=杜艳新, title=58同城iOS客户端Hybrid框架探索, body=58同城iOS客户端的Hybrid框架在最初设计和演进的过程中，遇到了许多问题。为此，整个Hybrid框架产生了很大的变化。本文作者将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架提供一些参考。

引言
Hybrid App是指同时使用Native与Web的App。Native界面具有良好的用户体验，但是不易动态改变，且开发成本较高。对于变动较大的页面，使用Web来实现是一个比较好的选择，所以，目前很多主流App都采用Native与Web混合的方式搭建。58同城客户端上线不久即采用了Hybrid方式，至今已有六七年。而iOS客户端的Hybrid框架在最初设计和演进的过程中，随着时间推移和业务需求的不断增加，遇到了许多问题。为了解决它们，整个Hybrid框架产生了很大的变化。本文将遇到的典型问题进行了总结，并重点介绍58 iOS采用的解决方案，希望能给读者搭建自己的Hybrid框架一些参考。主要包括以下四个方面：

1. 通讯方式以及通讯框架
58 App最初采用的Web调用Native的通讯方式是AJAX请求，不仅存在内存泄露问题，且Native在回调给Web结果时无法确定回调给哪个Web View。另外，如何搭建一个简单、实用、扩展性好的Hybrid框架是一个重点内容。这些内容将在通讯部分详细介绍。

2. 缓存原理及缓存框架
提升Web页面响应速度的一个有效手段就是使用缓存。58 iOS客户端如何对Web资源进行缓存以及如何搭建Hybrid缓存框架将在缓存部分介绍。

3. 性能
iOS 8推出了WebKit框架，核心是WKWebView，其在性能上要远优于UIWebView，并且提供了一些新的功能，但遗憾的是WKWebView不支持自定义缓存。我们经过调研和测试发现了一些从UIWebView升级到WKWebView的可行解决方案，将在性能部分重点介绍。

4. 耦合
58 iOS客户端最初的Hybrid框架设计过于简单，导致Web载体页渐渐变得十分臃肿，继承关系十分复杂。耦合部分详细介绍了平稳解决载体页耦合问题的方案。

通讯
Hybrid框架首先要考虑的问题就是Web与Native之间的通讯。苹果在iOS 7系统推出了JavaScriptCore.framework框架，通过该框架可以方便地实现JavaScript与Native的通讯工作。但是在58 App最早引入Hybrid时，需要支持iOS 7以下的系统版本，所以58 App并没有使用JavaScriptCore.framework，而是采用了更原始的方式。

传统的通讯方式（如图1所示）中，Native调用JavaScript代码比较简单，直接使用UIWebView提供的接口stringByEvaluatingJavaScriptFromString:就可以实现。而JavaScript调用Native的功能需要通过拦截请求的方式来实现。即JavaScript发送一个特殊的URL请求，该请求并不是真正的网络访问请求，而是调用Native功能的请求，并传递相关的参数。Native端收到请求后进行判断，如果是功能调URL请求则调用Native的相应功能，而不进行网络访问。)], prePage=0, nextPage=0, isFirstPage=false, isLastPage=false, hasPreviousPage=false, hasNextPage=false, navigatePages=0, navigateFirstPage0, navigateLastPage0, navigatepageNums=null}
